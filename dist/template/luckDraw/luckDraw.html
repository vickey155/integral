<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta name="msapplication-tap-highlight" content="no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="x5-fullscreen" content="true">
    <title>积分抽奖</title>
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="../../global/css/global.css">
    <script type="text/javascript" src="../../global/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../global/js/common.js"></script>
    <script>
      $(function () {
        document.documentElement.style.fontSize = document.documentElement.clientWidth / 7.5 + 'px';
      });
      
    </script>
  </head>
  <body>
    <section class="luckDraw">
      <div class="banner">
        <div class="sec-top">
          <div class="integral-num"><span class="icon-star-yellow"></span>我的积分：1460</div><a href="" class="drawRecord">抽奖记录</a>
        </div>
        <div class="bg"></div>
        <div class="tip-time"><span class="icon"></span>今天还有<i id="drawTimes">3</i>次机会哦</div>
      </div>
      <div class="luck-wrap">
        <div id="deng" class="shanDeng">
          <div id="luck">
            <div class="wrap">
              <div class="row">
                <div data-id="1" data-index="0" data-status="20元红包" class="luck-unit luck-unit-0"><span class="bg"></span><img src="/global/image/luck/icon_gift_1.png">
                  <p>10元红包</p>
                </div>
                <div data-id="2" data-index="1" data-status="20积分" class="luck-unit luck-unit-1"><span class="bg"></span><img src="/global/image/luck/icon_gift_2.png">
                  <p>20积分</p>
                </div>
                <div data-id="3" data-index="2" data-status="扫地机器人" class="luck-unit luck-unit-2"><span class="bg"></span><img src="/global/image/luck/icon_gift_2.png">
                  <p>扫地机器人</p>
                </div>
              </div>
              <div class="row">
                <div data-id="4" data-index="7" data-status="iphone8" class="luck-unit luck-unit-7"><span class="bg"></span><img src="/global/image/luck/icon_gift_5.png">
                  <p>iphone8 256G</p>
                </div>
                <div id="drawBtn" class="cjBtn">
                  <p>-50积分</p>
                </div>
                <div data-id="5" data-index="3" data-status="15元满" class="luck-unit luck-unit-3"><span class="bg"></span><img src="/global/image/luck/icon_gift_5.png">
                  <p>15元满减券</p>
                </div>
              </div>
              <div class="row">
                <div data-id="6" data-index="6" data-status="80积分" class="luck-unit luck-unit-6"><span class="bg"></span><img src="/global/image/luck/icon_gift_1.png">
                  <p>80积分</p>
                </div>
                <div data-id="7" data-index="5" data-status="0.3%加息券" class="luck-unit luck-unit-5"><span class="bg"></span><img src="/global/image/luck/icon_gift_4.png">
                  <p>0.3%加息券</p>
                </div>
                <div data-id="8" data-index="4" data-status="null" class="luck-unit luck-unit-4"><span class="bg"></span><img src="/global/image/luck/icon_gift_1.png">
                  <p>20元红包</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="draw-rule"><a href="javascript:void(0);" id="ruleBtn">抽奖规则<i class="arrow-right-white"></i></a></div>
      <div class="plr32">
        <div class="drawed-user">
          <div class="title">中奖用户</div>
          <div class="cont">
            <div class="swiper-container">
              <ul class="swiper-wrapper">
                <li class="swiper-slide"><span>139****8907</span><span>christing</span><span>抽中 20元红包</span></li>
                <li class="swiper-slide"><span>139****8907</span><span>christing</span><span>抽中 20元红包</span></li>
                <li class="swiper-slide"><span>139****8907</span><span>christing</span><span>抽中 20元红包</span></li>
                <li class="swiper-slide"><span>139****8907</span><span>christing</span><span>抽中 20元红包</span></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="footer"></div>
    </section>
    <div class="bg-pic-pop"></div>
    <div class="dia-pic luck-pop rule-pop">
      <div class="dialog-cont">
        <div class="dia-close"></div>
        <div class="luckPic">
          <div class="imgBg"></div>
        </div>
        <div class="cont">
          <div class="title">抽奖规则</div>
          <p>1. 每次抽奖消耗10积分；</p>
          <p>2. 每天仅限3次；</p>
          <p>3. 积分不够则不能参与抽奖；</p>
          <p>4. 可在抽奖记录查看抽奖详情。</p>
        </div>
      </div>
    </div>
    <div class="dia-pic luck-pop integral-null">
      <div class="dialog-cont">
        <div class="dia-close"></div>
        <div class="luckPic">
          <div class="imgBg"></div>
        </div>
        <div class="cont">
          <p>亲，您的积分不够了！</p>
        </div><a href="javascript:void(0);" class="a-btn-bg-yellow">去赚积分</a>
      </div>
    </div>
    <div class="dia-pic luck-pop drawed-pop">
      <div class="dia-close"></div>
      <div class="cont">
        <p class="title">恭喜您！</p>
        <p class="big-font">中了<span id="prizeName" class="red-font">20积分</span></p>
        <p class="red-font">已放到您的积分账户中</p>
      </div><a href="javascript:void(0);" class="a-btn-bg-yellow">了解奖品使用详情</a>
    </div>
    <script type="text/javascript" src="../../global/js/luckDraw.js"></script>
    <script type="text/javascript" src="../../global/js/swiper.min.js"></script>
    <script>
      $(function () {
        var len = $('.swiper-container .swiper-slide').length;
        var mySwiper = new Swiper('.swiper-container', {
          direction: 'vertical',
          autoplay: true,
          delay: 800,
          speed: 400,
          loop: true,
          slidesPerView: 'auto',
          loopedSlides: len
        });
        if (mySwiper.slides.length <= 4) {
          mySwiper.destroy();
        }
        //抽奖规则
        $('#ruleBtn').onClick('click',function () {
          $(".bg-pic-pop").show()
          $(".rule-pop").show()
        });
        //关闭弹层
        commonEvent.closePicDia();
      
        if (Number($("#drawTimes").text()) <= 0) {
          $('#drawBtn').addClass('disabledBtn');
        }
      
        luckDraw.init();//背景灯闪烁
        var prizeName = '';
        $("#luck").onClick('click','#drawBtn',function () {
          var self = $(this);
          if (self.hasClass('disabledBtn')) {
            return false;
          }
          var times = Number($("#drawTimes").text());
          self.addClass('disabledBtn');
          if (times <= 0) {
            var tip = '今天的抽奖次数已用完了，明天再来试试吧~';
            commonEvent.alertDialog(tip);
            $("#drawBtn").removeClass("disabledBtn");
            return false;
          }
          else{
            times--;
            $("#drawTimes").text(times);
          }
      
          //积分不够
          //lessIntegral();
          //抽奖成功 当转盘有多个无奖励时  data-status == 'null',
          luckDraw.clickFn(callBackSuc);
          setTimeout(function () {
            var prizeId = 8; // data-id='6' data-status='80积分'
            if($("#luck").find('[data-id = "'+prizeId+'"]')[0]){
              prizeName = $("#luck").find('[data-id = "' + prizeId + '"]').eq(0).attr('data-status');
              var prizeIndex = $("#luck").find('[data-id = "' + prizeId + '"]').eq(0).attr('data-index');
              luckDraw.setPrizeId(prizeIndex,prizeName);
            }
            else{
              commonEvent.alertDialog('没有找到中奖id');
             }
      
          },600);
        });
        //抽奖按钮
        var lessIntegral = function () { //积分不够
          $(".bg-pic-pop").show()
          $(".integral-null").show()
        }
        var callBackSuc = function () { //抽中了
          $("#prizeName").html(prizeName);
          $(".bg-pic-pop").show()
          $(".drawed-pop").show()
        }
      });
    </script>
  </body>
</html>